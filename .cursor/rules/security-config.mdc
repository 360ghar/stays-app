---
alwaysApply: false
description: Security best practices and configuration management for Flutter app
---

# Security & Configuration Guidelines

## Environment Variables
Environment files must be properly configured and never committed:

### Required Environment Files (Actual Implementation)
- **`.env.dev`**: Development environment (loaded by `main_dev.dart`)
- **`.env.staging`**: Staging environment (loaded by `main_staging.dart`)
- **`.env.prod`**: Production environment (loaded by `main_prod.dart`)

### Key Environment Variables (Actual Usage)
```bash
# API Configuration
API_BASE_URL=https://api.dev.360ghar.com

# Supabase Configuration (main backend)
SUPABASE_URL=https://dev-project.supabase.co
SUPABASE_ANON_KEY=your-dev-anon-key-here

# Analytics Configuration
ENABLE_ANALYTICS=false

# Maps Configuration (optional)
GOOGLE_MAPS_API_KEY=your-dev-maps-key
# or
GOOGLE_PLACES_API_KEY=your-dev-places-key
```

## Security Best Practices

### Data Handling
- **Never log sensitive data**: Remove API keys, tokens, passwords from logs
- **Encrypt sensitive data**: Use proper encryption for stored data
- **Validate input**: Always validate and sanitize user inputs
- **Use HTTPS**: All API calls must use HTTPS in production

### Authentication & Authorization
- **Token Management**: Implement secure token refresh mechanisms
- **Session Handling**: Properly handle session expiration and logout
- **Route Guards**: Protect routes that require authentication
- **Password Policies**: Enforce strong password requirements

### API Security
- **Request Signing**: Sign API requests when possible
- **Rate Limiting**: Implement rate limiting for API calls
- **Error Handling**: Don't expose sensitive error details to users
- **CORS**: Properly configure CORS policies

## Configuration Management

### AppConfig Class (Actual Implementation)
Current configuration management in `lib/config/app_config.dart`:

```dart
class AppConfig {
  final String environment;
  final String apiBaseUrl;
  final String supabaseUrl;
  final String supabaseAnonKey;
  final bool enableAnalytics;
  final String? googleMapsApiKey;

  static late AppConfig _instance;

  static AppConfig get I => _instance;

  const AppConfig({
    required this.environment,
    required this.apiBaseUrl,
    required this.supabaseUrl,
    required this.supabaseAnonKey,
    this.enableAnalytics = false,
    this.googleMapsApiKey,
  });

  static void setConfig(AppConfig config) {
    _instance = config;
  }

  static AppConfig dev() => fromDotEnv(environment: 'dev');
  static AppConfig staging() => fromDotEnv(environment: 'staging');
  static AppConfig prod() => fromDotEnv(environment: 'prod');

  static bool get isProduction => I.environment == 'prod';
  static bool get isStaging => I.environment == 'staging';
  static bool get isDev => I.environment == 'dev';

  static AppConfig fromDotEnv({required String environment}) {
    final env = dotenv.env;
    return AppConfig(
      environment: environment,
      apiBaseUrl: env['API_BASE_URL'] ?? 'https://api.dev.360ghar.com',
      supabaseUrl: env['SUPABASE_URL'] ?? 'https://YOUR_DEV_SUPABASE_URL',
      supabaseAnonKey: env['SUPABASE_ANON_KEY'] ?? 'YOUR_DEV_SUPABASE_ANON_KEY',
      enableAnalytics: (env['ENABLE_ANALYTICS'] ?? (environment == 'prod' ? 'true' : 'false')) == 'true',
      // Support either GOOGLE_MAPS_API_KEY or GOOGLE_PLACES_API_KEY
      googleMapsApiKey: env['GOOGLE_MAPS_API_KEY'] ?? env['GOOGLE_PLACES_API_KEY'],
    );
  }
}
```

### Environment-Specific Configuration (Actual Structure)
Current environment configuration in `lib/config/environments/`:

```dart
// lib/config/environments/dev_config.dart
import '../../app_config.dart';

class DevConfig extends AppConfig {
  DevConfig()
      : super(
          environment: 'dev',
          apiBaseUrl: 'https://api.dev.360ghar.com',
          supabaseUrl: 'https://dev-project.supabase.co',
          supabaseAnonKey: 'your-dev-anon-key',
          enableAnalytics: false,
        );
}

// lib/config/environments/staging_config.dart
import '../../app_config.dart';

class StagingConfig extends AppConfig {
  StagingConfig()
      : super(
          environment: 'staging',
          apiBaseUrl: 'https://api.staging.360ghar.com',
          supabaseUrl: 'https://staging-project.supabase.co',
          supabaseAnonKey: 'your-staging-anon-key',
          enableAnalytics: true,
        );
}

// lib/config/environments/prod_config.dart
import '../../app_config.dart';

class ProdConfig extends AppConfig {
  ProdConfig()
      : super(
          environment: 'prod',
          apiBaseUrl: 'https://api.360ghar.com',
          supabaseUrl: 'https://prod-project.supabase.co',
          supabaseAnonKey: 'your-prod-anon-key',
          enableAnalytics: true,
        );
}
```

### Feature Flags
Implement feature flags for controlled rollouts:

```dart
class FeatureFlags {
  static const bool enableNewBookingFlow = true;
  static const bool enablePushNotifications = false;
  // Environment-specific feature flags
}
```

## Secret Management

### .gitignore Configuration
Ensure sensitive files are properly ignored:

```gitignore
# Environment files
.env
.env.*
!.env.example

# Build artifacts
build/
android/app/build/
ios/Pods/

# IDE files
.vscode/
.idea/
*.swp
*.swo

# OS files
.DS_Store
Thumbs.db
```

### Example .env.example File
Provide a template for environment variables:

```bash
# .env.example
API_BASE_URL=your-api-url-here
SUPABASE_URL=your-supabase-url-here
SUPABASE_ANON_KEY=your-anon-key-here
STRIPE_PUBLISHABLE_KEY=your-stripe-key-here
ANALYTICS_KEY=your-analytics-key-here
```

## Code Security

### Dependency Security
- **Regular Updates**: Keep dependencies updated to latest secure versions
- **Vulnerability Scanning**: Use tools like `flutter pub outdated` and `flutter pub upgrade`
- **License Compliance**: Ensure all dependencies have compatible licenses

### Code Review Security Checklist
- [ ] No hardcoded secrets or API keys
- [ ] Proper input validation and sanitization
- [ ] Secure authentication flow implementation
- [ ] No sensitive data in logs or error messages
- [ ] Proper error handling without information leakage
- [ ] HTTPS usage for all external communications
- [ ] Secure storage of sensitive data

## Build Security

### Release Build Configuration
- **Obfuscation**: Enable code obfuscation for production builds
- **Signing**: Properly sign Android and iOS builds
- **ProGuard/R8**: Configure for Android release builds

### CI/CD Security
- **Secret Management**: Use secure secret storage in CI/CD pipelines
- **Build Verification**: Verify builds are from trusted sources
- **Automated Security Scanning**: Integrate security scanning tools

## Monitoring & Alerting

### Error Tracking
- **Sentry Integration**: Configure Sentry for error tracking
- **Custom Logging**: Implement structured logging for security events
- **Alert Configuration**: Set up alerts for security-related events

### Performance Monitoring
- **API Monitoring**: Monitor API response times and error rates
- **User Analytics**: Track user behavior for security insights
- **Performance Metrics**: Monitor app performance and resource usage